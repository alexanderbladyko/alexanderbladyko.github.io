(this["webpackJsonprhythm-trainer"]=this["webpackJsonprhythm-trainer"]||[]).push([[0],{10:function(e,n,t){e.exports={base:"NumberInput_base__Zg2rR",value:"NumberInput_value__3KOx4",button:"NumberInput_button__3lUuw"}},187:function(e,n,t){e.exports=t.p+"static/media/quarter.bb8e6d28.svg"},188:function(e,n,t){e.exports=t.p+"static/media/eights.31053e72.svg"},189:function(e,n,t){e.exports=t.p+"static/media/sixteens.1f967ff7.svg"},190:function(e,n,t){e.exports=t.p+"static/media/triplet.e0d4aa7c.svg"},2:function(e,n,t){e.exports={base:"ChangingMetronomeExercise_base__16576",caption:"ChangingMetronomeExercise_caption__QD0x9",notes:"ChangingMetronomeExercise_notes__3Yn_X",bpm:"ChangingMetronomeExercise_bpm__14BG_",sequence:"ChangingMetronomeExercise_sequence__3bIBb",action:"ChangingMetronomeExercise_action__22W3D",info:"ChangingMetronomeExercise_info__BtdnQ",score:"ChangingMetronomeExercise_score__sjZJy",start:"ChangingMetronomeExercise_start__clgPa",blink:"ChangingMetronomeExercise_blink__146W5",ticks:"ChangingMetronomeExercise_ticks__13MLz"}},229:function(e,n,t){"use strict";t.r(n);var a,r,c=t(0),i=t.n(c),s=t(20),o=t.n(s),l=(t(99),i.a.createContext([])),u=t(85),d=t.n(u),m=t(14),b=t.n(m),f=t(9),v=t(3),h=t(86),p=t.n(h),g=t(4),E=t.n(g),_=t(1),k=t(48),N=t(21),O=t(37),y=t.n(O);!function(e){e[e.Fours=0]="Fours",e[e.Eights=1]="Eights",e[e.Sixteens=2]="Sixteens",e[e.Triplets=3]="Triplets"}(r||(r={}));a={},Object(_.a)(a,r.Fours,[0]),Object(_.a)(a,r.Eights,[0,.5]),Object(_.a)(a,r.Sixteens,[0,.25,.5,.75]),Object(_.a)(a,r.Triplets,[0,1/3,2/3]);var C,x,T=t(87),j=t.n(T),S=t(49),I=t.n(S),w=(C={},Object(_.a)(C,r.Fours,t(187)),Object(_.a)(C,r.Eights,t(188)),Object(_.a)(C,r.Sixteens,t(189)),Object(_.a)(C,r.Triplets,t(190)),C),D=function(e){var n=e.isDraggingAway?j.a:w[e.note];return i.a.createElement("div",Object.assign({key:e.blinkIndex,ref:e.draggableRef,className:y()(I.a.base,Object(_.a)({},I.a.base__blink,-1!==e.blinkIndex))},e.draggingProps),i.a.createElement("img",{alt:"",src:n}))},R=t(25),q=t.n(R);!function(e){e.NOTES="notes",e.SEQUENCE="sequence"}(x||(x={}));var M,P=function(e){return i.a.createElement(N.a,{onDragEnd:function(n){var t=n.source,a=n.destination;if(t.droppableId===x.SEQUENCE){if(!a||a.droppableId!==x.SEQUENCE){var r=Object(f.a)(e.sequence);return r.splice(t.index,1),e.onSequenceChange(r)}return e.onSequenceChange(function(e,n,t){var a=Object(f.a)(e),r=a.splice(n,1),c=Object(v.a)(r,1)[0];return a.splice(t,0,c),a}(e.sequence,t.index,a.index))}if(t.droppableId===x.NOTES&&(null===a||void 0===a?void 0:a.droppableId)===x.SEQUENCE){var c=Object(f.a)(e.sequence);return c.splice(a.index,0,e.notes[t.index]),e.onSequenceChange(c)}}},e.children)},A=function(e){return i.a.createElement(N.c,{droppableId:x.NOTES,direction:"horizontal",isDropDisabled:!0},(function(n){return i.a.createElement("div",Object.assign({ref:n.innerRef,className:q.a.source},n.droppableProps,{style:{transitionDuration:"0.001s"}}),e.notes.map((function(e,n){return i.a.createElement(N.b,{key:e,draggableId:"note_".concat(e),index:n},(function(n,t){return i.a.createElement(i.a.Fragment,null,i.a.createElement(D,{draggableRef:n.innerRef,note:e,draggingProps:Object(k.a)({},n.draggableProps,{},n.dragHandleProps)}),t.isDragging&&i.a.createElement(D,{note:e}))}))})),i.a.createElement("div",{style:{display:"none"}},n.placeholder))}))},F=function(e){return e.isPlaying?i.a.createElement("div",{className:q.a.sequence},e.sequence.map((function(n,t){return i.a.createElement(D,{key:t,note:n,blinkIndex:t===e.noteIndex?e.playingIndex:-1})}))):i.a.createElement(N.c,{droppableId:x.SEQUENCE,direction:"horizontal"},(function(n,t){return i.a.createElement("div",{ref:n.innerRef,className:y()(q.a.sequence,Object(_.a)({},q.a.sequence__over,t.isDraggingOver))},e.sequence.map((function(e,n){return i.a.createElement(N.b,{key:n,draggableId:"sequence_note_".concat(n),index:n},(function(n,t){return i.a.createElement(D,{draggableRef:n.innerRef,note:e,isDraggingAway:t.isDragging&&!t.draggingOver,draggingProps:Object(k.a)({},n.draggableProps,{},n.dragHandleProps)})}))})),i.a.createElement("div",{style:{display:"none"}},n.placeholder))}))},U=t(5),L=t(15),H=t(12),K=t(11),W=t(13),z=t(92),G=t.n(z),B=function(e){function n(e){var t;return Object(U.a)(this,n),(t=Object(H.a)(this,Object(K.a)(n).call(this,e))).canvas=void 0,t.onResize=function(){t.canvas.current&&(t.canvas.current.height=t.canvas.current.parentElement.clientHeight,t.canvas.current.width=t.canvas.current.parentElement.clientWidth,t.draw())},t.draw=function(){if(t.canvas.current){var e=t.canvas.current.getContext("2d"),n=t.canvas.current,a=n.width,r=n.height;if(e){e.clearRect(0,0,a,r);var c=t.props.idealClicks[t.props.from]-.5,i=t.props.idealClicks[t.props.idealClicks.length-1]-c+.5;t.props.idealClicks.forEach((function(n){return t.drawLine(e,a*(n-c)/i,0,r/2,"#4287f5")})),t.props.realClicks.forEach((function(n){return t.drawLine(e,a*(n.actualClick-c)/i,r/2,r,t.getColorByDelta(n.delta))}))}}},t.drawLine=function(e,n,t,a,r){var c=Math.round(n);e.beginPath(),e.strokeStyle=r,e.moveTo(c,t),e.lineTo(c,t+a),e.stroke(),e.closePath()},t.getColorByDelta=function(e){return e>.2?"#FF0000":e>.1?"#FFFF00":"#00FF00"},t.canvas=i.a.createRef(),t}return Object(W.a)(n,e),Object(L.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize),this.onResize()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize)}},{key:"componentDidUpdate",value:function(){this.draw()}},{key:"render",value:function(){return i.a.createElement("div",{className:G.a.base},i.a.createElement("canvas",{ref:this.canvas}))}}]),n}(i.a.Component),Q=t(10),J=t.n(Q),V=function(e){var n=i.a.useState(e.value),t=Object(v.a)(n,2),a=t[0],r=t[1],c=function(n){var t=Math.max(Math.min(n,500),10);r(t),e.onChanged(t)},s=function(e){c(parseInt(e.target.value))};return i.a.createElement("div",{className:J.a.base},i.a.createElement("div",{className:J.a.button,onClick:c.bind(null,a-10)},"-10"),i.a.createElement("div",{className:J.a.button,onClick:c.bind(null,a-5)},"-5"),i.a.createElement("div",{className:J.a.button,onClick:c.bind(null,a-1)},"-1"),i.a.createElement("input",{className:J.a.value,min:10,max:500,type:"number",onChange:s,onBlur:s,onWheel:function(e){c(a+(e.deltaY>0?-1:1))},value:a}),i.a.createElement("div",{className:J.a.button,onClick:c.bind(null,a+1)},"+1"),i.a.createElement("div",{className:J.a.button,onClick:c.bind(null,a+5)},"+5"),i.a.createElement("div",{className:J.a.button,onClick:c.bind(null,a+10)},"+10"))},Y=function(){function e(){Object(U.a)(this,e),this.allowKeys=[],this.anyKey=!1,this.startTime=0}return Object(L.a)(e,[{key:"setStartTime",value:function(e){this.startTime=e}},{key:"beforeRun",value:function(){return Promise.resolve()}},{key:"run",value:function(){return Promise.resolve()}},{key:"afterRun",value:function(){return Promise.resolve()}},{key:"onKeyboardEvent",value:function(e,n){}},{key:"onMouseEvent",value:function(e){}}]),e}(),Z=function(){function e(){Object(U.a)(this,e),this.handlers=void 0,this.startTime=0,this.endTime=0,this.inProgress=!1,this.handlers=[]}return Object(L.a)(e,[{key:"addHandler",value:function(e){return this.handlers.push(e),this}},{key:"start",value:function(){var e=this;return b.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return this.inProgress=!0,this.startTime=(new Date).getTime(),Promise.all(this.handlers.map((function(n){return n.setStartTime(e.startTime)}))),n.next=5,b.a.awrap(Promise.all(this.handlers.map((function(e){return e.beforeRun()}))));case 5:return n.next=7,b.a.awrap(Promise.all(this.handlers.map((function(e){return e.run()}))));case 7:return n.next=9,b.a.awrap(Promise.all(this.handlers.map((function(e){return e.afterRun()}))));case 9:case"end":return n.stop()}}),null,this)}}]),e}(),X=function(e){function n(e,t){var a;return Object(U.a)(this,n),(a=Object(H.a)(this,Object(K.a)(n).call(this))).context=void 0,a.gain=void 0,a.oscillator=void 0,a.clicks=void 0,a.preClicksCount=void 0,a.clicks=e,a.preClicksCount=t,a.context=new AudioContext,a.oscillator=a.context.createOscillator(),a.oscillator.type="sine",a.oscillator.frequency.value=1e3,a.gain=a.context.createGain(),a.gain.gain.value=0,a.gain.connect(a.context.destination),a.oscillator.connect(a.gain),a}return Object(W.a)(n,e),Object(L.a)(n,[{key:"beforeRun",value:function(){var e=this;return 0===this.clicks.length?Promise.resolve():(this.clicks.forEach((function(n){e.gain.gain.cancelScheduledValues(n),e.gain.gain.setValueAtTime(0,n),e.gain.gain.linearRampToValueAtTime(1,n+.001),e.gain.gain.linearRampToValueAtTime(0,n+.001+.01)})),this.oscillator.start(0),new Promise((function(n){return setTimeout(n,1e3*e.clicks[e.preClicksCount-1])})))}},{key:"run",value:function(){var e=this,n=this.clicks[this.preClicksCount-1];return new Promise((function(t){return setTimeout(t,1e3*(e.clicks[e.clicks.length-1]-n)+300)}))}}]),n}(Y),$=function(e){function n(e,t){var a;return Object(U.a)(this,n),(a=Object(H.a)(this,Object(K.a)(n).call(this))).callback=void 0,a.clicks=void 0,a.clicks=e,a.callback=t,a}return Object(W.a)(n,e),Object(L.a)(n,[{key:"beforeRun",value:function(){var e=this;return this.clicks.length>0&&this.clicks.forEach((function(n,t){return setTimeout((function(){return e.callback(n,t)}),1e3*n)})),Promise.resolve()}}]),n}(Y),ee=function(e){function n(e,t){var a;return Object(U.a)(this,n),(a=Object(H.a)(this,Object(K.a)(n).call(this,(function(e){a.userClicks.push((e-a.startTime)/1e3),t(a.getUserClicks())})))).clicks=void 0,a.userClicks=void 0,a.getUserClicks=function(){var e=[];return a.userClicks.forEach((function(n){var t=a.clicks.reduce((function(e,t){return Math.abs(e)>Math.abs(t-n)?t-n:e}),1/0);e.push({desiredClick:n+t,actualClick:n,delta:t})})),e},a.clicks=e,a.userClicks=[],a}return Object(W.a)(n,e),n}(function(e){function n(e){var t;return Object(U.a)(this,n),(t=Object(H.a)(this,Object(K.a)(n).call(this))).anyKey=!0,t.callback=void 0,t.handleKeydown=function(e){var n=(new Date).getTime();(t.anyKey||t.allowKeys.includes(e.key))&&t.onKeyboardEvent(n,e.key)},t.handleMouseDown=function(){var e=(new Date).getTime();t.onMouseEvent(e)},t.callback=e,t}return Object(W.a)(n,e),Object(L.a)(n,[{key:"run",value:function(){return document.addEventListener("keydown",this.handleKeydown),document.addEventListener("mousedown",this.handleMouseDown),Promise.resolve()}},{key:"afterRun",value:function(){return document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("mousedown",this.handleMouseDown),Promise.resolve()}},{key:"onKeyboardEvent",value:function(e,n){this.callback(e-50)}},{key:"onMouseEvent",value:function(e){this.callback(e-50)}}]),n}(Y)),ne=(M={},Object(_.a)(M,r.Fours,Array.apply(0,Array(4)).map((function(e,n){return n/4}))),Object(_.a)(M,r.Eights,Array.apply(0,Array(8)).map((function(e,n){return n/8}))),Object(_.a)(M,r.Triplets,Array.apply(0,Array(12)).map((function(e,n){return n/12}))),Object(_.a)(M,r.Sixteens,Array.apply(0,Array(16)).map((function(e,n){return n/16}))),M);function te(e,n){var t=240/n,a=[];return e.forEach((function(e,n){a=[].concat(Object(f.a)(a),Object(f.a)(ne[e].map((function(e){return t*(e+1*n)}))))})),a}function ae(e){var n=[];return e.forEach((function(e,t){ne[e].forEach((function(){n.push(t)}))})),n}var re,ce=t(2),ie=t.n(ce);!function(e){e[e.NOT_STARTED=0]="NOT_STARTED",e[e.COUNTDOWN=1]="COUNTDOWN",e[e.RUNNING=2]="RUNNING",e[e.FINISHED=3]="FINISHED",e[e.FAILED_TO_START=4]="FAILED_TO_START"}(re||(re={}));var se={changingMetronome:function(){var e,n=[r.Fours,r.Eights,r.Triplets,r.Sixteens],t=parseInt(localStorage.getItem("saved_bpm")||"60",10);try{if(e=JSON.parse(localStorage.getItem("saved_sequence")),!E()(e))throw Error()}catch(J){e=[].concat(n)}var a=i.a.useState([]),c=Object(v.a)(a,2),s=c[0],o=c[1],l=i.a.useState([]),u=Object(v.a)(l,2),d=u[0],m=u[1],h=i.a.useState(e),g=Object(v.a)(h,2),_=g[0],k=g[1],N=i.a.useState([]),O=Object(v.a)(N,2),y=O[0],C=O[1],x=i.a.useState(t),T=Object(v.a)(x,2),j=T[0],S=T[1],I=i.a.useState(0),w=Object(v.a)(I,2),D=w[0],R=w[1],q=i.a.useState(re.NOT_STARTED),M=Object(v.a)(q,2),U=M[0],L=M[1],H=i.a.useState(0),K=Object(v.a)(H,2),W=K[0],z=K[1],G=function(e){o(e)},Q=function(e,n){z(n-4),n<4&&R(n+1),3===n&&L(re.RUNNING)};return i.a.createElement("div",{className:ie.a.base},i.a.createElement("div",{key:W,className:ie.a.blink}),i.a.createElement(P,{sequence:_,onSequenceChange:k,notes:n},i.a.createElement("div",{className:ie.a.notes},i.a.createElement("div",{className:ie.a.caption},"Notes (drag to sequence)"),i.a.createElement(A,{notes:n})),i.a.createElement("div",{className:ie.a.bpm},i.a.createElement("div",{className:ie.a.caption},"BPM"),i.a.createElement(V,{onChanged:S,value:j})),i.a.createElement("div",{className:ie.a.sequence},i.a.createElement("div",{className:ie.a.caption},"Sequence (size: 4/4)"),i.a.createElement(F,{isPlaying:U===re.COUNTDOWN||U===re.RUNNING,sequence:_,noteIndex:y[W],playingIndex:W}))),i.a.createElement("div",{className:ie.a.action},U===re.NOT_STARTED&&i.a.createElement("div",{className:ie.a.info},"Manage sequence, choose bpm and click start"),U===re.COUNTDOWN&&i.a.createElement("div",{className:ie.a.info},D),(U===re.RUNNING||U===re.COUNTDOWN)&&i.a.createElement("div",{className:ie.a.info},"Use any keyboard or mouse button to click"),(U===re.RUNNING||U===re.FINISHED)&&i.a.createElement("div",{className:ie.a.ticks},i.a.createElement(B,{idealClicks:d,realClicks:s,from:4})),U===re.FINISHED&&0!==s.length&&i.a.createElement("div",{className:ie.a.info},"Missed notes:",i.a.createElement("span",{className:ie.a.score},Math.max(d.length-p()(s,(function(e){return e.desiredClick})).length-4,0)),"Average delta:",i.a.createElement("span",{className:ie.a.score},Math.round(1e3*s.map((function(e){return Math.abs(e.delta)})).reduce((function(e,n){return e+n}))/s.length)/1e3)),U===re.FINISHED&&0===s.length&&i.a.createElement("div",{className:ie.a.info},"No results"),(U===re.NOT_STARTED||U===re.FINISHED||U===re.FAILED_TO_START)&&i.a.createElement("button",{className:ie.a.start,onClick:function(){var e,n;return b.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(U!==re.COUNTDOWN&&U!==re.RUNNING){t.next=2;break}return t.abrupt("return");case 2:if(localStorage.setItem("saved_bpm",j.toString()),localStorage.setItem("saved_sequence",JSON.stringify(_)),0!==_.length){t.next=7;break}return L(re.FAILED_TO_START),t.abrupt("return");case 7:return e=te([r.Fours].concat(Object(f.a)(_)),j),C(ae(_)),o([]),L(re.COUNTDOWN),m(e),(n=new Z).addHandler(new X(e,4)),n.addHandler(new $(e,Q)),n.addHandler(new ee(e,G)),t.next=18,b.a.awrap(n.start());case 18:L(re.FINISHED);case 19:case"end":return t.stop()}}))}},"START")))}},oe=function(){var e=i.a.useContext(l);return i.a.createElement("div",{className:d.a.base},e.map((function(e){return i.a.createElement(i.a.Fragment,{key:e},se[e]({}))})))},le=t(93),ue=t.n(le),de=function(){return i.a.createElement("div",{className:ue.a.app},i.a.createElement(l.Provider,{value:Object.keys(se)},i.a.createElement(oe,null)))};o.a.render(i.a.createElement(de,null),document.getElementById("root"))},25:function(e,n,t){e.exports={base:"NotesSequence_base__1DLs1",source:"NotesSequence_source__1m3s8",sequence:"NotesSequence_sequence__3IvSb",sequence__over:"NotesSequence_sequence__over__1DJ-P"}},49:function(e,n,t){e.exports={base:"Note_base__3WI4L",base__blink:"Note_base__blink__ZRsMK",blink:"Note_blink__jrqpf"}},85:function(e,n,t){e.exports={base:"ExerciseList_base__3RYu2"}},87:function(e,n,t){e.exports=t.p+"static/media/cancel.02d5c191.svg"},92:function(e,n,t){e.exports={base:"UserClicksCanvas_base__1VIGR"}},93:function(e,n,t){e.exports={app:"App_app__2ziFi"}},94:function(e,n,t){e.exports=t(229)},99:function(e,n,t){}},[[94,1,2]]]);
//# sourceMappingURL=main.f69f2aa7.chunk.js.map